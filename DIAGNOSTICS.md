# Инструкция по диагностике ошибки "invalid controller (default/index)"

## Что было добавлено:

1. **Обработка ошибок в `controllers/default.py`**:
   - Добавлен try-except блок в функцию `index()`
   - При ошибке будет показана детальная информация: тип ошибки, сообщение, traceback

2. **Диагностический контроллер `controllers/debug.py`**:
   - Создан для проверки различных аспектов работы приложения

## Как использовать для диагностики:

### Шаг 1: Проверьте базовую работу контроллера
Откройте в браузере на боевом сервере:
```
http://your-server/adminlte5/debug/test
```
Если это работает - контроллеры загружаются. Если нет - проблема в базовой конфигурации web2py.

### Шаг 2: Проверьте импорты
```
http://your-server/adminlte5/debug/test_imports
```
Это покажет, какие импорты работают, а какие нет.

### Шаг 3: Проверьте вызов default/index
```
http://your-server/adminlte5/debug/test_default_index
```
Это попытается вызвать функцию `index()` из контроллера `default` и покажет, где именно возникает ошибка.

### Шаг 4: Проверьте права доступа к файлам
```
http://your-server/adminlte5/debug/test_file_permissions
```
Проверит, что web2py может читать необходимые файлы.

### Шаг 5: Запустите все тесты сразу
```
http://your-server/adminlte5/debug/test_all
```

### Шаг 6: Попробуйте открыть главную страницу
```
http://your-server/adminlte5/default/index
```
Теперь при ошибке вы увидите детальную информацию вместо просто "invalid controller".

## Возможные причины ошибки:

1. **Проблемы с импортом модулей**:
   - Модуль `dashboard_data` не найден
   - Модуль `project_statuses_service` не найден (используется в dashboard_data)

2. **Проблемы с базой данных**:
   - База данных не инициализирована
   - Нет прав доступа к базе данных
   - Таблицы не созданы

3. **Проблемы с правами доступа к файлам**:
   - Web2py не может читать файлы контроллера или модулей
   - Неправильные права на файлы (должны быть читаемыми для пользователя, под которым работает web2py)

4. **Синтаксические ошибки**:
   - Ошибка в Python коде, которая не видна на локальном сервере из-за кэширования

5. **Проблемы с кодировкой файлов**:
   - Файлы сохранены в неправильной кодировке

## Что проверить на боевом сервере:

1. **Права доступа к файлам**:
   ```bash
   ls -la /opt/web2py/applications/adminlte5/controllers/default.py
   ls -la /opt/web2py/applications/adminlte5/modules/dashboard_data.py
   ```
   Файлы должны быть читаемыми для пользователя, под которым работает web2py.

2. **Логи web2py**:
   ```bash
   tail -f /opt/web2py/applications/adminlte5/errors/*
   ```
   Или проверьте последние файлы в папке `errors/`.

3. **Логи веб-сервера** (если используется Apache/Nginx):
   ```bash
   tail -f /var/log/apache2/error.log
   # или
   tail -f /var/log/nginx/error.log
   ```

4. **Проверьте, что все файлы загружены**:
   Убедитесь, что файл `modules/dashboard_data.py` и `modules/project_statuses_service.py` существуют на боевом сервере.

## После диагностики:

После того, как найдете причину ошибки, можно:
- Удалить контроллер `debug.py` (он только для диагностики)
- Упростить обработку ошибок в `default.py` (оставить только необходимое)
