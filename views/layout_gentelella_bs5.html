<!DOCTYPE html>
<html lang="{{=T.accepted_language or 'en'}}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{=response.title or request.application}}</title>
  <link rel="icon" href="{{=URL('static','images/favicon.ico')}}" type="image/x-icon">
  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    body { overflow-y: auto; }
    .content-main { overflow-x: hidden; }
    .table-responsive { max-height: none !important; overflow: visible !important; }
    .navbar-gentelella { background: #2A3F54 !important; padding: 0.25rem 1rem; }
    .navbar-gentelella.sticky-top { position: sticky; top: 0; z-index: 1030; box-shadow: 0 2px 8px rgba(0,0,0,.15); }
    .navbar-gentelella .navbar-brand { color: #fff !important; padding: 12px 0; font-size: 1.25rem; }
    .navbar-gentelella .navbar-brand:hover { color: rgba(255,255,255,.9) !important; }
    .navbar-gentelella .nav-link { color: rgba(255,255,255,.85) !important; padding: 12px 14px; }
    .navbar-gentelella .nav-link:hover, .navbar-gentelella .nav-link.active { color: #fff !important; background: rgba(255,255,255,.1); }
    .navbar-gentelella .nav-link i { margin-right: 6px; }
    .navbar-gentelella .dropdown-menu { border: none; box-shadow: 0 4px 12px rgba(0,0,0,.15); }
    .navbar-gentelella .dropdown-item { padding: 8px 16px; }
    .navbar-gentelella .dropdown-item:hover { background: #f8f9fa; }
    .navbar-gentelella .navbar-toggler { border-color: rgba(255,255,255,.3); color: rgba(255,255,255,.85); }
    .navbar-gentelella .navbar-toggler:focus { box-shadow: 0 0 0 2px rgba(255,255,255,.25); }
    .content-main { padding: 20px; min-height: 100vh; background: #f8f9fa; }
    .flash-toast { position: fixed; top: 1rem; right: 1rem; z-index: 9999; max-width: 400px; box-shadow: 0 0.5rem 1rem rgba(0,0,0,.2); }
    .navbar-gentelella .navbar-nav.ms-auto .nav-link { padding: 8px 12px; }
    .navbar-gentelella .navbar-nav.ms-auto .dropdown-menu { min-width: 12rem; }
  </style>
  {{block head}}{{end}}
</head>
<body>
  <!-- Horizontal top menu (закреплено сверху при прокрутке) -->
  <nav class="navbar navbar-expand-lg navbar-gentelella sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{=URL('default','index')}}"><i class="bi bi-speedometer2"></i> {{=request.application or 'CRM'}}</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarGentelella" aria-controls="navbarGentelella" aria-expanded="false" aria-label="Меню">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarGentelella">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link {{='active' if request.function == 'index' and request.controller == 'default' else ''}}" href="{{=URL('default','index')}}"><i class="bi bi-speedometer2"></i> Главная</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {{='active' if request.controller == 'customers' else ''}}" href="{{=URL('customers','customers_list')}}"><i class="bi bi-people"></i> Клиенты</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle {{='active' if request.controller in ('project_statuses','specification_statuses','nomenclature_items','nomenclature_item_types','user_roles','branches','users') else ''}}" href="#" id="navbarSettings" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-gear"></i> Настройки</a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarSettings">
              <li><a class="dropdown-item" href="{{=URL('project_statuses','list')}}"><i class="bi bi-tag me-2"></i>Статус проекта</a></li>
              <li><a class="dropdown-item" href="{{=URL('specification_statuses','list')}}"><i class="bi bi-tag me-2"></i>Статус спецификации</a></li>
              <li><a class="dropdown-item" href="{{=URL('user_roles','list')}}"><i class="bi bi-person-badge me-2"></i>Роли</a></li>
              <li><a class="dropdown-item" href="{{=URL('branches','list')}}"><i class="bi bi-building me-2"></i>Филиалы</a></li>
              <li><a class="dropdown-item" href="{{=URL('users','list')}}"><i class="bi bi-people me-2"></i>Пользователи</a></li>
              <li><a class="dropdown-item" href="{{=URL('nomenclature_items','list')}}"><i class="bi bi-box-seam me-2"></i>Номенклатура</a></li>
              <li><a class="dropdown-item" href="{{=URL('nomenclature_item_types','list')}}"><i class="bi bi-tags me-2"></i>Типы позиций номенклатуры</a></li>
            </ul>
          </li>
        </ul>
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle py-1 px-2" href="#" id="navbarMessages" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="Сообщения">
              <i class="bi bi-envelope fs-5"></i>
              <span class="badge rounded-pill bg-success ms-1" id="msgBadge" style="font-size: 0.65rem;">0</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-lg-end" aria-labelledby="navbarMessages" style="min-width: 280px;">
              <li><h6 class="dropdown-header">Сообщения</h6></li>
              <li><a class="dropdown-item text-muted small" href="#">Нет новых сообщений</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-center small" href="#">Все сообщения</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center py-1 px-2" href="#" id="navbarUser" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-circle fs-4 me-1"></i>
              <span>{{=auth.user.first_name if auth.user else 'Гость'}} {{=auth.user.last_name if auth.user else ''}}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarUser">
              <li><a class="dropdown-item" href="{{=URL('default','user', args=['profile'])}}"><i class="bi bi-person me-2"></i>Профиль</a></li>
              <li><a class="dropdown-item" href="{{=URL('users','list')}}"><i class="bi bi-gear me-2"></i>Настройки</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-question-circle me-2"></i>Помощь</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="{{=URL('default','user', args=['logout'])}}"><i class="bi bi-box-arrow-right me-2"></i>Выход</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  {{if response.flash:}}
  <div id="flashToast" class="flash-toast alert alert-info alert-dismissible fade show" role="alert">{{=response.flash}}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Закрыть"></button>
  </div>
  <script>setTimeout(function(){ var el = document.getElementById('flashToast'); if(el){ el.classList.remove('show'); setTimeout(function(){ el.remove(); }, 150); } }, 5000);</script>
  {{pass}}
  <!-- Main content -->
  <main class="content-main">
    {{block header}}{{end}}
    {{include}}
    {{=response.toolbar() if response.show_toolbar else ''}}
    {{block footer}}
    <footer class="mt-4 pt-3 border-top text-muted small">
      <div class="float-end">{{=request.application}} — Bootstrap 5.3</div>
      <div class="clearfix"></div>
    </footer>
    {{end}}
  </main>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  {{block page_js}}{{end}}
</body>
</html>
